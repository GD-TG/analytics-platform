# üîå –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Yandex API

## –í–∞—à–∏ credentials:

- **Client ID**: `081345a9f48742d18f6cbacf890cfb1b`
- **Client Secret**: `bd90a984306e4d3bb8cdea8fb492610e`

## üìù –®–∞–≥ 1: –î–æ–±–∞–≤—å—Ç–µ credentials –≤ .env

–û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª `.env` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞ –∏ –¥–æ–±–∞–≤—å—Ç–µ:

```env
# Yandex OAuth credentials
YANDEX_CLIENT_ID=081345a9f48742d18f6cbacf890cfb1b
YANDEX_CLIENT_SECRET=bd90a984306e4d3bb8cdea8fb492610e
YANDEX_OAUTH_TOKEN=–≤–∞—à_oauth_—Ç–æ–∫–µ–Ω_–∑–¥–µ—Å—å

# Direct API (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
DIRECT_CLIENT_LOGIN=–ª–æ–≥–∏–Ω_–∫–ª–∏–µ–Ω—Ç–∞_–≤_–¥–∏—Ä–µ–∫—Ç–µ

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏
YANDEX_DEFAULT_CURRENCY=RUB
DEFAULT_TIMEZONE=Europe/Moscow
```

## üîë –®–∞–≥ 2: –ü–æ–ª—É—á–∏—Ç–µ OAuth —Ç–æ–∫–µ–Ω

### –í–∞—Ä–∏–∞–Ω—Ç –ê: –ß–µ—Ä–µ–∑ –±—Ä–∞—É–∑–µ—Ä (—Å–∞–º—ã–π –ø—Ä–æ—Å—Ç–æ–π)

1. **–û—Ç–∫—Ä–æ–π—Ç–µ —ç—Ç—É —Å—Å—ã–ª–∫—É:**
   ```
   https://oauth.yandex.ru/authorize?response_type=token&client_id=081345a9f48742d18f6cbacf890cfb1b
   ```

2. **–ê–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—å** –≤ –Ø–Ω–¥–µ–∫—Å

3. **–†–∞–∑—Ä–µ—à–∏—Ç–µ –¥–æ—Å—Ç—É–ø** –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é

4. **–°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ç–æ–∫–µ–Ω** –∏–∑ URL –±—Ä–∞—É–∑–µ—Ä–∞:
   - –ü–æ—Å–ª–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –≤ –∞–¥—Ä–µ—Å–Ω–æ–π —Å—Ç—Ä–æ–∫–µ –±—É–¥–µ—Ç: `access_token=–í–ê–®_–¢–û–ö–ï–ù`
   - –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ—Å–ª–µ `access_token=`

5. **–í—Å—Ç–∞–≤—å—Ç–µ —Ç–æ–∫–µ–Ω –≤ `.env`:**
   ```env
   YANDEX_OAUTH_TOKEN=–í–ê–®_–¢–û–ö–ï–ù
   ```

### –í–∞—Ä–∏–∞–Ω—Ç –ë: –ß–µ—Ä–µ–∑ API endpoint

1. **–ü–æ–ª—É—á–∏—Ç–µ URL –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:**
   ```bash
   curl http://localhost:8000/api/yandex/auth-url
   ```

2. **–û—Ç–∫—Ä–æ–π—Ç–µ –ø–æ–ª—É—á–µ–Ω–Ω—ã–π URL** –≤ –±—Ä–∞—É–∑–µ—Ä–µ

3. **–°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∫–æ–¥** –∏–∑ URL (–ø–∞—Ä–∞–º–µ—Ç—Ä `code=...`)

4. **–û–±–º–µ–Ω—è–π—Ç–µ –∫–æ–¥ –Ω–∞ —Ç–æ–∫–µ–Ω:**
   ```bash
   curl -X POST http://localhost:8000/api/yandex/exchange-code \
     -H "Content-Type: application/json" \
     -d "{\"code\":\"–≤–∞—à_–∫–æ–¥\"}"
   ```

5. **–°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ç–æ–∫–µ–Ω** –∏–∑ –æ—Ç–≤–µ—Ç–∞ –∏ –¥–æ–±–∞–≤—å—Ç–µ –≤ `.env`

## ‚úÖ –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫—É

1. **–û—á–∏—Å—Ç–∏—Ç–µ –∫–µ—à:**
   ```bash
   php artisan config:clear
   ```

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–æ–∫–µ–Ω:**
   ```bash
   curl http://localhost:8000/api/yandex/validate-token
   ```

   –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å—Å—è JSON —Å `"is_valid": true`

## üöÄ –®–∞–≥ 4: –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç–æ–∫–µ–Ω–∞ –∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é –¥–∞–Ω–Ω—ã—Ö:

```bash
php artisan analytics:sync-daily
```

–≠—Ç–æ –∑–∞–≥—Ä—É–∑–∏—Ç —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ –Ø–Ω–¥–µ–∫—Å.–ú–µ—Ç—Ä–∏–∫–∏ –∏ –Ø–Ω–¥–µ–∫—Å.–î–∏—Ä–µ–∫—Ç–∞ –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö.

## üìä –ß—Ç–æ –±—É–¥–µ—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å—Å—è:

- **–Ø–Ω–¥–µ–∫—Å.–ú–µ—Ç—Ä–∏–∫–∞:**
  - –í–∏–∑–∏—Ç—ã –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
  - –í–æ–∑—Ä–∞—Å—Ç–Ω—ã–µ –≥—Ä—É–ø–ø—ã
  - –¶–µ–ª–∏ –∏ –∫–æ–Ω–≤–µ—Ä—Å–∏–∏
  - –î–∞–Ω–Ω—ã–µ –ø–æ –¥–Ω—è–º –∏ –º–µ—Å—è—Ü–∞–º

- **–Ø–Ω–¥–µ–∫—Å.–î–∏—Ä–µ–∫—Ç:**
  - –ö–∞–º–ø–∞–Ω–∏–∏
  - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∫–∞–º–ø–∞–Ω–∏—è–º
  - –ò—Ç–æ–≥–æ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏
  - –†–∞—Å—Ö–æ–¥—ã –∏ –∫–æ–Ω–≤–µ—Ä—Å–∏–∏

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã:

–ü–æ—Å–ª–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –¥–æ—Å—Ç—É–ø–Ω—ã —á–µ—Ä–µ–∑ API:
- `GET /api/statistics` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
- `GET /api/visits` - –¥–∞–Ω–Ω—ã–µ –≤–∏–∑–∏—Ç–æ–≤
- `GET /api/sources` - –∏—Å—Ç–æ—á–Ω–∏–∫–∏ —Ç—Ä–∞—Ñ–∏–∫–∞
- `GET /api/age-data` - –≤–æ–∑—Ä–∞—Å—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

## ‚ö†Ô∏è –í–∞–∂–Ω–æ:

1. **–¢–æ–∫–µ–Ω –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è** - –ø—Ä–∏ –∏—Å—Ç–µ—á–µ–Ω–∏–∏ –ø–æ–ª—É—á–∏—Ç–µ –Ω–æ–≤—ã–π
2. **–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ –ë–î –µ—Å—Ç—å –ø—Ä–æ–µ–∫—Ç—ã –∏ —Å—á–µ—Ç—á–∏–∫–∏** –ø–µ—Ä–µ–¥ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–µ–π
3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏** –µ—Å–ª–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç: `storage/logs/laravel.log`

